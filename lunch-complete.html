<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§›ìˆëŠ” ê¸‰ì‹ ğŸ±</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/react-icons@4.11.0/index.esm.js" type="module"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // ì•„ì´ì½˜ì„ ì´ëª¨ì§€ë¡œ ëŒ€ì²´
        const Calendar = () => <span>ğŸ“…</span>;
        const Heart = ({ fill }) => <span>{fill ? 'â¤ï¸' : 'ğŸ¤'}</span>;
        const Share2 = () => <span>ğŸ“¤</span>;
        const TrendingUp = () => <span>ğŸ“ˆ</span>;
        const Star = ({ fill }) => <span>{fill ? 'â­' : 'â˜†'}</span>;
        const Search = () => <span>ğŸ”</span>;
        const Sparkles = () => <span>âœ¨</span>;
        const Settings = () => <span>âš™ï¸</span>;

// ==========================================
// ğŸ”‘ API í‚¤ ì„¤ì •
// ==========================================
// ì•„ë˜ì— NEIS ì˜¤í”ˆ APIì—ì„œ ë°œê¸‰ë°›ì€ ì¸ì¦í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
// 
// ğŸ“ API í‚¤ ë°œê¸‰ ë°©ë²•:
// 1. https://open.neis.go.kr ì ‘ì†
// 2. íšŒì›ê°€ì… ë° ë¡œê·¸ì¸
// 3. 'ì¸ì¦í‚¤ ì‹ ì²­' ë©”ë‰´ì—ì„œ ì‹ ì²­
// 4. ë°œê¸‰ë°›ì€ í‚¤ë¥¼ ì•„ë˜ YOUR_API_KEY_HERE ë¶€ë¶„ì— ë¶™ì—¬ë„£ê¸°
// 
// ì˜ˆì‹œ: const NEIS_API_KEY = 'abc123def456ghi789jkl012mno345pqr678stu901';
// ==========================================

const NEIS_API_KEY = '6c95ddeef5e0436893e707bf07c7dfc5';

// ==========================================

const SchoolLunchApp = () => {
  const [schoolName, setSchoolName] = useState('');
  const [searchResults, setSearchResults] = useState([]);
  const [selectedSchool, setSelectedSchool] = useState(null);
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [mealData, setMealData] = useState(null);
  const [weeklyData, setWeeklyData] = useState([]);
  const [loading, setLoading] = useState(false);
  const [searchLoading, setSearchLoading] = useState(false);
  const [viewMode, setViewMode] = useState('daily');
  const [ratings, setRatings] = useState({});
  const [statistics, setStatistics] = useState({});
  const [showWelcome, setShowWelcome] = useState(true);
  const [showSettings, setShowSettings] = useState(false);
  const [defaultSchoolName, setDefaultSchoolName] = useState('');

  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  useEffect(() => {
    const savedRatings = localStorage.getItem('schoolLunchRatings');
    const savedStats = localStorage.getItem('schoolLunchStats');
    const savedDefaultSchool = localStorage.getItem('schoolLunchDefaultSchool');
    const hasVisited = localStorage.getItem('schoolLunchHasVisited');
    
    if (savedRatings) setRatings(JSON.parse(savedRatings));
    if (savedStats) setStatistics(JSON.parse(savedStats));
    
    // ë°©ë¬¸ ê¸°ë¡ì´ ìˆìœ¼ë©´ í™˜ì˜ í™”ë©´ ìŠ¤í‚µ
    if (hasVisited) {
      setShowWelcome(false);
      
      // ê¸°ë³¸ í•™êµê°€ ì €ì¥ë˜ì–´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ë¡œë“œ
      if (savedDefaultSchool) {
        const defaultSchool = JSON.parse(savedDefaultSchool);
        setDefaultSchoolName(defaultSchool.name);
        setSelectedSchool(defaultSchool);
        setSchoolName(defaultSchool.name);
      }
    }
  }, []);

  // ê¸°ë³¸ í•™êµê°€ ì„¤ì •ë˜ë©´ ìë™ìœ¼ë¡œ ê¸‰ì‹ ì¡°íšŒ
  useEffect(() => {
    if (selectedSchool && !showWelcome) {
      fetchMealData(selectedDate);
    }
  }, [selectedSchool]);

  // ìŒì‹ ì´ëª¨ì§€ ë§¤ì¹­
  const getFoodEmoji = (foodName) => {
    const emojiMap = {
      'ë°¥': 'ğŸš', 'ìŒ€': 'ğŸŒ¾', 'ì¡ê³¡': 'ğŸŒ¾',
      'ê¹€ì¹˜': 'ğŸ¥¬', 'ë°°ì¶”': 'ğŸ¥¬', 'ê¹ë‘ê¸°': 'ğŸ¥•',
      'êµ­': 'ğŸ²', 'ì°Œê°œ': 'ğŸ²', 'íƒ•': 'ğŸ²',
      'ë‹­': 'ğŸ—', 'ì¹˜í‚¨': 'ğŸ—',
      'ë¼ì§€': 'ğŸ¥“', 'ì‚¼ê²¹ì‚´': 'ğŸ¥“', 'ëª©ì‚´': 'ğŸ¥“',
      'ì†Œê³ ê¸°': 'ğŸ¥©', 'ë¶ˆê³ ê¸°': 'ğŸ¥©', 'ìŠ¤í…Œì´í¬': 'ğŸ¥©',
      'ìƒì„ ': 'ğŸŸ', 'ê³ ë“±ì–´': 'ğŸŸ', 'ê°ˆì¹˜': 'ğŸŸ', 'ì‚¼ì¹˜': 'ğŸŸ',
      'ìƒˆìš°': 'ğŸ¦', 'ì˜¤ì§•ì–´': 'ğŸ¦‘',
      'ê³„ë€': 'ğŸ¥š', 'ë‹¬ê±€': 'ğŸ¥š',
      'ë‘ë¶€': 'ğŸ§ˆ', 'ì½©': 'ğŸ«˜',
      'ë‹¹ê·¼': 'ğŸ¥•', 'ë¸Œë¡œì½œë¦¬': 'ğŸ¥¦',
      'ê³ êµ¬ë§ˆ': 'ğŸ ', 'ê°ì': 'ğŸ¥”',
      'ìš°ìœ ': 'ğŸ¥›', 'ìš”êµ¬ë¥´íŠ¸': 'ğŸ¥›',
      'ê³¼ì¼': 'ğŸ', 'ì‚¬ê³¼': 'ğŸ', 'ë°°': 'ğŸ', 'ê·¤': 'ğŸŠ', 'ë°”ë‚˜ë‚˜': 'ğŸŒ',
      'ë”¸ê¸°': 'ğŸ“', 'ìˆ˜ë°•': 'ğŸ‰', 'í¬ë„': 'ğŸ‡',
      'ë¹µ': 'ğŸ', 'ìƒŒë“œìœ„ì¹˜': 'ğŸ¥ª',
      'ìŠ¤íŒŒê²Œí‹°': 'ğŸ', 'íŒŒìŠ¤íƒ€': 'ğŸ',
      'í”¼ì': 'ğŸ•', 'í–„ë²„ê±°': 'ğŸ”',
      'ë–¡': 'ğŸ¡', 'ë–¡ë³¶ì´': 'ğŸ¡',
      'ë§Œë‘': 'ğŸ¥Ÿ', 'êµ°ë§Œë‘': 'ğŸ¥Ÿ',
      'ì¹´ë ˆ': 'ğŸ›', 'ë³¶ìŒë°¥': 'ğŸ›',
      'ìƒëŸ¬ë“œ': 'ğŸ¥—', 'ìƒì¶”': 'ğŸ¥—',
      'ê¹€': 'ğŸŸ¢', 'ë¯¸ì—­': 'ğŸŸ¢',
      'ë¼ë©´': 'ğŸœ', 'ìš°ë™': 'ğŸœ',
    };

    for (const [key, emoji] of Object.entries(emojiMap)) {
      if (foodName.includes(key)) return emoji;
    }
    return 'ğŸ½ï¸';
  };

  // ì•Œë ˆë¥´ê¸° ì •ë³´ í•˜ì´ë¼ì´íŠ¸
  const highlightAllergens = (text) => {
    const allergens = ['ëŒ€ë‘', 'ë°€', 'ìš°ìœ ', 'ê³„ë€', 'ë•…ì½©', 'ìƒˆìš°', 'ê²Œ', 'ì˜¤ì§•ì–´', 'ê³ ë“±ì–´', 'ë¼ì§€ê³ ê¸°', 'ë³µìˆ­ì•„', 'í† ë§ˆí† '];
    let highlighted = text;
    
    allergens.forEach(allergen => {
      if (text.includes(allergen)) {
        highlighted = highlighted.replace(
          new RegExp(allergen, 'g'),
          `<span class="allergen">${allergen}</span>`
        );
      }
    });
    
    return highlighted;
  };

  // ë‚ ì§œ í¬ë§·íŒ…
  const formatDate = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}${month}${day}`;
  };

  // í•™êµëª…ìœ¼ë¡œ ê²€ìƒ‰
  const searchSchools = async (name) => {
    if (!name || name.trim().length < 2) {
      setSearchResults([]);
      return;
    }

    setSearchLoading(true);
    try {
      const url = `https://open.neis.go.kr/hub/schoolInfo?KEY=${NEIS_API_KEY}&Type=json&pIndex=1&pSize=100&SCHUL_NM=${encodeURIComponent(name)}`;
      
      const response = await fetch(url);
      const data = await response.json();
      
      if (data.schoolInfo && data.schoolInfo[1]) {
        const schools = data.schoolInfo[1].row;
        setSearchResults(schools);
      } else {
        setSearchResults([]);
      }
    } catch (error) {
      console.error('Error searching schools:', error);
      setSearchResults([]);
    }
    setSearchLoading(false);
  };

  // í•™êµ ì„ íƒ
  const selectSchool = (school) => {
    const schoolData = {
      name: school.SCHUL_NM,
      officeCode: school.ATPT_OFCDC_SC_CODE,
      schoolCode: school.SD_SCHUL_CODE,
      address: school.ORG_RDNMA || school.ORG_RDNMA,
    };
    setSelectedSchool(schoolData);
    setSchoolName(school.SCHUL_NM);
    setSearchResults([]);
  };

  // ê¸‰ì‹ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const fetchMealData = async (date) => {
    if (!selectedSchool) {
      alert('í•™êµë¥¼ ë¨¼ì € ê²€ìƒ‰í•˜ê³  ì„ íƒí•´ì£¼ì„¸ìš”!');
      return;
    }

    setLoading(true);
    try {
      const dateStr = formatDate(date);
      const url = `https://open.neis.go.kr/hub/mealServiceDietInfo?KEY=${NEIS_API_KEY}&Type=json&pIndex=1&pSize=100&ATPT_OFCDC_SC_CODE=${selectedSchool.officeCode}&SD_SCHUL_CODE=${selectedSchool.schoolCode}&MLSV_YMD=${dateStr}`;
      
      const response = await fetch(url);
      const data = await response.json();
      
      if (data.mealServiceDietInfo && data.mealServiceDietInfo[1]) {
        const meals = data.mealServiceDietInfo[1].row;
        // ì¤‘ì‹ë§Œ í•„í„°ë§
        const lunchData = meals.find(meal => meal.MMEAL_SC_NM === 'ì¤‘ì‹') || meals[0];
        setMealData(lunchData);
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        updateStatistics(lunchData);
      } else {
        setMealData(null);
        alert('í•´ë‹¹ ë‚ ì§œì˜ ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
      }
    } catch (error) {
      console.error('Error fetching meal data:', error);
      alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í•™êµë¥¼ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
    }
    setLoading(false);
  };

  // ì£¼ê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const fetchWeeklyData = async () => {
    if (!selectedSchool) return;

    const weekly = [];
    const startDate = new Date(selectedDate);
    startDate.setDate(startDate.getDate() - startDate.getDay()); // ì£¼ì˜ ì‹œì‘ì¼ (ì¼ìš”ì¼)

    for (let i = 0; i < 7; i++) {
      const currentDate = new Date(startDate);
      currentDate.setDate(startDate.getDate() + i);
      
      try {
        const dateStr = formatDate(currentDate);
        const url = `https://open.neis.go.kr/hub/mealServiceDietInfo?KEY=${NEIS_API_KEY}&Type=json&pIndex=1&pSize=100&ATPT_OFCDC_SC_CODE=${selectedSchool.officeCode}&SD_SCHUL_CODE=${selectedSchool.schoolCode}&MLSV_YMD=${dateStr}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.mealServiceDietInfo && data.mealServiceDietInfo[1]) {
          const meals = data.mealServiceDietInfo[1].row;
          const lunchData = meals.find(meal => meal.MMEAL_SC_NM === 'ì¤‘ì‹') || meals[0];
          weekly.push({ date: currentDate, data: lunchData });
        } else {
          weekly.push({ date: currentDate, data: null });
        }
      } catch (error) {
        weekly.push({ date: currentDate, data: null });
      }
    }
    
    setWeeklyData(weekly);
  };

  // í†µê³„ ì—…ë°ì´íŠ¸
  const updateStatistics = (meal) => {
    if (!meal || !meal.DDISH_NM) return;
    
    const dishes = meal.DDISH_NM.split('<br/>');
    const newStats = { ...statistics };
    
    dishes.forEach(dish => {
      const cleanDish = dish.replace(/\([^)]*\)/g, '').trim();
      newStats[cleanDish] = (newStats[cleanDish] || 0) + 1;
    });
    
    setStatistics(newStats);
    localStorage.setItem('schoolLunchStats', JSON.stringify(newStats));
  };

  // ì¦ê²¨ì°¾ê¸° ì¶”ê°€/ì œê±°
  const toggleFavorite = () => {
    if (!selectedSchool) return;
    
    const exists = favorites.find(f => f.schoolCode === selectedSchool.schoolCode);
    
    let newFavorites;
    if (exists) {
      newFavorites = favorites.filter(f => f.schoolCode !== selectedSchool.schoolCode);
    } else {
      newFavorites = [...favorites, selectedSchool];
    }
    
    setFavorites(newFavorites);
    localStorage.setItem('schoolLunchFavorites', JSON.stringify(newFavorites));
  };

  // í‰ê°€ ì €ì¥
  const rateMeal = (rating) => {
    const dateKey = formatDate(selectedDate);
    const newRatings = { ...ratings, [dateKey]: rating };
    setRatings(newRatings);
    localStorage.setItem('schoolLunchRatings', JSON.stringify(newRatings));
  };

  // ê³µìœ  ê¸°ëŠ¥
  const shareMeal = () => {
    if (!mealData) return;
    
    const shareText = `${mealData.SCHUL_NM} ${selectedDate.toLocaleDateString('ko-KR')} ê¸‰ì‹\n${mealData.DDISH_NM.replace(/<br\/>/g, '\n')}`;
    
    if (navigator.share) {
      navigator.share({
        title: 'ì˜¤ëŠ˜ì˜ ê¸‰ì‹',
        text: shareText,
      });
    } else {
      navigator.clipboard.writeText(shareText);
      alert('ê¸‰ì‹ ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
  };

  // í™˜ì˜ í™”ë©´ ì‹œì‘
  const startApp = async () => {
    localStorage.setItem('schoolLunchHasVisited', 'true');
    
    // ê¸°ë³¸ í•™êµê°€ ì…ë ¥ë˜ì–´ ìˆìœ¼ë©´ ê²€ìƒ‰
    if (defaultSchoolName) {
      await searchSchools(defaultSchoolName);
      setSchoolName(defaultSchoolName);
    }
    
    setShowWelcome(false);
  };

  // ê¸°ë³¸ í•™êµ ì„¤ì • ì €ì¥
  const saveDefaultSchool = () => {
    if (!selectedSchool) {
      alert('í•™êµë¥¼ ë¨¼ì € ê²€ìƒ‰í•˜ê³  ì„ íƒí•´ì£¼ì„¸ìš”!');
      return;
    }
    
    localStorage.setItem('schoolLunchDefaultSchool', JSON.stringify(selectedSchool));
    setDefaultSchoolName(selectedSchool.name);
    alert(`${selectedSchool.name}ì´(ê°€) ê¸°ë³¸ í•™êµë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    setShowSettings(false);
  };

  // ì˜ì–‘ì†Œ íŒŒì‹±
  const parseNutrition = (ntrInfo) => {
    if (!ntrInfo) return null;
    
    const nutrients = {};
    const items = ntrInfo.split(' * ');
    items.forEach(item => {
      const [name, value] = item.split(' : ');
      if (name && value) {
        nutrients[name.trim()] = parseFloat(value.replace(/[^0-9.]/g, ''));
      }
    });
    
    return nutrients;
  };

  // ìƒìœ„ ë©”ë‰´ í†µê³„
  const getTopDishes = () => {
    const sorted = Object.entries(statistics).sort((a, b) => b[1] - a[1]);
    return sorted.slice(0, 5);
  };

  const currentRating = ratings[formatDate(selectedDate)];

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 p-4 font-['Gowun_Dodum']">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
        
        .allergen {
          background-color: #FFE4E1;
          color: #DC143C;
          padding: 2px 6px;
          border-radius: 4px;
          font-weight: bold;
        }
        
        .meal-card {
          transition: all 0.3s ease;
          animation: fadeInUp 0.5s ease;
        }
        
        .meal-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .emoji-float {
          animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
          0%, 100% { transform: translateY(0px); }
          50% { transform: translateY(-10px); }
        }
        
        .gradient-text {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }
      `}</style>

      <div className="max-w-6xl mx-auto">
        {/* í—¤ë” */}
        <div className="text-center mb-8 pt-8 relative">
          <h1 className="text-5xl font-bold gradient-text mb-3 flex items-center justify-center gap-3">
            <span className="emoji-float">ğŸ±</span>
            ë§›ìˆëŠ” ê¸‰ì‹
            <span className="emoji-float" style={{animationDelay: '1s'}}>âœ¨</span>
          </h1>
          <p className="text-gray-600 text-lg">ì˜¤ëŠ˜ì˜ ì ì‹¬ ë©”ë‰´ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</p>
          
          {!showWelcome && (
            <button
              onClick={() => setShowSettings(true)}
              className="absolute top-0 right-0 bg-white p-3 rounded-full shadow-lg hover:shadow-xl transition-all"
              title="ì„¤ì •"
            >
              âš™ï¸
            </button>
          )}
        </div>

        {/* í™˜ì˜ í™”ë©´ */}
        {showWelcome && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
              <div className="text-center mb-6">
                <div className="text-6xl mb-4">ğŸ±</div>
                <h2 className="text-3xl font-bold gradient-text mb-2">ë§›ìˆëŠ” ê¸‰ì‹ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                <p className="text-gray-600">í•™êµ ê¸‰ì‹ ì •ë³´ë¥¼ ì‰½ê³  ì˜ˆì˜ê²Œ í™•ì¸í•˜ì„¸ìš”</p>
              </div>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2 text-gray-700">ìì£¼ ë³´ëŠ” í•™êµ (ì„ íƒ)</label>
                  <input
                    type="text"
                    value={defaultSchoolName}
                    onChange={(e) => setDefaultSchoolName(e.target.value)}
                    placeholder="ì˜ˆ: ì„œìš¸ê³ ë“±í•™êµ"
                    className="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:outline-none focus:border-purple-400"
                  />
                  <p className="text-xs text-gray-500 mt-1">
                    ì…ë ¥í•˜ë©´ ë‹¤ìŒ ë°©ë¬¸ ì‹œ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤
                  </p>
                </div>
                
                <button
                  onClick={startApp}
                  className="w-full bg-gradient-to-r from-purple-400 to-pink-400 text-white py-3 rounded-xl font-bold hover:from-purple-500 hover:to-pink-500 transition-all"
                >
                  ì‹œì‘í•˜ê¸° ğŸ‰
                </button>
                
                <div className="bg-blue-50 p-4 rounded-xl">
                  <p className="text-xs text-gray-700 leading-relaxed">
                    ğŸ’¡ <strong>ì‚¬ìš© ë°©ë²•:</strong><br/>
                    í•™êµëª…ì„ ê²€ìƒ‰í•˜ê³  ë‚ ì§œë¥¼ ì„ íƒí•˜ì—¬<br/>
                    ê¸‰ì‹ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
                  </p>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* ì„¤ì • ëª¨ë‹¬ */}
        {showSettings && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-2xl font-bold gradient-text">âš™ï¸ ì„¤ì •</h2>
                <button
                  onClick={() => setShowSettings(false)}
                  className="text-gray-500 hover:text-gray-700 text-2xl"
                >
                  âœ•
                </button>
              </div>
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2 text-gray-700">í˜„ì¬ ì„ íƒëœ í•™êµ</label>
                  <div className="px-4 py-3 bg-gray-100 rounded-xl">
                    {selectedSchool ? selectedSchool.name : 'ì„ íƒëœ í•™êµ ì—†ìŒ'}
                  </div>
                </div>
                
                {selectedSchool && (
                  <button
                    onClick={saveDefaultSchool}
                    className="w-full bg-gradient-to-r from-green-400 to-emerald-400 text-white py-3 rounded-xl font-bold hover:from-green-500 hover:to-emerald-500 transition-all"
                  >
                    ì´ í•™êµë¥¼ ê¸°ë³¸ í•™êµë¡œ ì„¤ì • â­
                  </button>
                )}
                
                {defaultSchoolName && (
                  <div className="bg-purple-50 p-4 rounded-xl">
                    <p className="text-sm text-gray-700">
                      <strong>í˜„ì¬ ê¸°ë³¸ í•™êµ:</strong><br/>
                      {defaultSchoolName}
                    </p>
                  </div>
                )}
                
                <div className="bg-blue-50 p-4 rounded-xl">
                  <p className="text-xs text-gray-700 leading-relaxed">
                    ğŸ’¡ ê¸°ë³¸ í•™êµë¥¼ ì„¤ì •í•˜ë©´ ì•±ì„ ì—´ ë•Œë§ˆë‹¤<br/>
                    í•´ë‹¹ í•™êµì˜ ê¸‰ì‹ì´ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤!
                  </p>
                </div>
              </div>
            </div>
          </div>
        )}

        {!showWelcome && (
          <>
            {/* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */}
            <div className="bg-white rounded-3xl shadow-xl p-6 mb-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                {/* í•™êµ ê²€ìƒ‰ */}
                <div className="relative">
                  <label className="block text-sm font-medium mb-2 text-gray-700">ğŸ« í•™êµ ê²€ìƒ‰</label>
                  <input
                    type="text"
                    value={schoolName}
                    onChange={(e) => {
                      setSchoolName(e.target.value);
                      searchSchools(e.target.value);
                    }}
                    placeholder="í•™êµëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì„œìš¸ê³ ë“±í•™êµ)"
                    className="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:outline-none focus:border-purple-400"
                  />
                  {searchLoading && (
                    <div className="absolute right-4 top-11 text-purple-500">
                      ê²€ìƒ‰ì¤‘...
                    </div>
                  )}
                  
                  {/* ê²€ìƒ‰ ê²°ê³¼ ë“œë¡­ë‹¤ìš´ */}
                  {searchResults.length > 0 && (
                    <div className="absolute z-10 w-full mt-2 bg-white border-2 border-purple-200 rounded-xl shadow-xl max-h-60 overflow-y-auto">
                      {searchResults.map((school, idx) => (
                        <div
                          key={idx}
                          onClick={() => selectSchool(school)}
                          className="px-4 py-3 hover:bg-purple-50 cursor-pointer border-b border-gray-100 last:border-b-0"
                        >
                          <div className="font-bold text-gray-800">{school.SCHUL_NM}</div>
                          <div className="text-sm text-gray-600">
                            {school.ORG_RDNMA || school.ORG_RDNZC}
                          </div>
                          <div className="text-xs text-gray-500">
                            {school.ATPT_OFCDC_SC_NM}
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                  
                  {selectedSchool && (
                    <div className="mt-2 px-3 py-2 bg-green-50 border-2 border-green-200 rounded-xl text-sm">
                      <strong className="text-green-700">âœ“ ì„ íƒë¨:</strong> {selectedSchool.name}
                    </div>
                  )}
                </div>
                
                {/* ë‚ ì§œ ì„ íƒ */}
                <div>
                  <label className="block text-sm font-medium mb-2 text-gray-700">ğŸ“… ë‚ ì§œ ì„ íƒ</label>
                  <input
                    type="date"
                    value={selectedDate.toISOString().split('T')[0]}
                    onChange={(e) => setSelectedDate(new Date(e.target.value))}
                    className="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:outline-none focus:border-purple-400"
                  />
                </div>
              </div>
              
              <div className="flex gap-3 flex-wrap">
                <button
                  onClick={() => fetchMealData(selectedDate)}
                  disabled={loading || !selectedSchool}
                  className="flex-1 min-w-[200px] bg-gradient-to-r from-purple-400 to-pink-400 text-white py-3 px-6 rounded-xl font-bold hover:from-purple-500 hover:to-pink-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                >
                  <Search /> {loading ? 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...' : 'ê¸‰ì‹ ì¡°íšŒ'}
                </button>
                
                <button
                  onClick={fetchWeeklyData}
                  disabled={!selectedSchool}
                  className="bg-gradient-to-r from-blue-400 to-cyan-400 text-white py-3 px-6 rounded-xl font-bold hover:from-blue-500 hover:to-cyan-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                >
                  <Calendar /> ì£¼ê°„ë³´ê¸°
                </button>
                
                {mealData && (
                  <>
                    <button
                      onClick={toggleFavorite}
                      className={`py-3 px-6 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${
                        favorites.some(f => f.schoolCode === selectedSchool?.schoolCode)
                          ? 'bg-gradient-to-r from-red-400 to-pink-400 text-white' 
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      <Heart fill={favorites.some(f => f.schoolCode === selectedSchool?.schoolCode) ? 'white' : 'none'} />
                      {favorites.some(f => f.schoolCode === selectedSchool?.schoolCode) ? 'ì¦ê²¨ì°¾ê¸°ë¨' : 'ì¦ê²¨ì°¾ê¸°'}
                    </button>
                    
                    <button
                      onClick={shareMeal}
                      className="bg-gradient-to-r from-green-400 to-emerald-400 text-white py-3 px-6 rounded-xl font-bold hover:from-green-500 hover:to-emerald-500 transition-all flex items-center justify-center gap-2"
                    >
                      <Share2 /> ê³µìœ 
                    </button>
                  </>
                )}
              </div>
            </div>

            {/* ì¦ê²¨ì°¾ê¸° ëª©ë¡ */}
            {favorites.length > 0 && (
              <div className="bg-white rounded-3xl shadow-xl p-6 mb-6">
                <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                  <Star className="text-yellow-500" fill="currentColor" />
                  ì¦ê²¨ì°¾ëŠ” í•™êµ
                </h3>
                <div className="flex gap-3 flex-wrap">
                  {favorites.map((fav, idx) => (
                    <button
                      key={idx}
                      onClick={() => {
                        setSelectedSchool(fav);
                        setSchoolName(fav.name);
                        setSearchResults([]);
                      }}
                      className="px-4 py-2 bg-gradient-to-r from-yellow-200 to-orange-200 rounded-full hover:from-yellow-300 hover:to-orange-300 transition-all font-medium"
                    >
                      {fav.name}
                    </button>
                  ))}
                </div>
              </div>
            )}

            {/* ë©”ì¸ ê¸‰ì‹ ì •ë³´ */}
            {mealData && (
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                {/* ë©”ë‰´ ì¹´ë“œ */}
                <div className="lg:col-span-2 bg-white rounded-3xl shadow-xl p-8 meal-card">
                  <div className="flex justify-between items-start mb-6">
                    <div>
                      <h2 className="text-3xl font-bold gradient-text mb-2">{mealData.SCHUL_NM}</h2>
                      <p className="text-gray-600">
                        {selectedDate.toLocaleDateString('ko-KR', { 
                          year: 'numeric', 
                          month: 'long', 
                          day: 'numeric',
                          weekday: 'long'
                        })}
                      </p>
                    </div>
                    <div className="text-4xl emoji-float">ğŸ½ï¸</div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <h3 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                      <Sparkles />
                      ì˜¤ëŠ˜ì˜ ë©”ë‰´
                    </h3>
                    {mealData.DDISH_NM.split('<br/>').map((dish, idx) => {
                      const cleanDish = dish.replace(/\([^)]*\)/g, '').trim();
                      const emoji = getFoodEmoji(cleanDish);
                      return (
                        <div key={idx} className="flex items-start gap-3 p-3 bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl">
                          <span className="text-2xl">{emoji}</span>
                          <span 
                            className="text-lg flex-1"
                            dangerouslySetInnerHTML={{ __html: highlightAllergens(dish) }}
                          />
                        </div>
                      );
                    })}
                  </div>

                  {/* ê¸‰ì‹ í‰ê°€ */}
                  <div className="mt-6 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl">
                    <h4 className="font-bold mb-3 text-gray-800">ì˜¤ëŠ˜ ê¸‰ì‹ ì–´ë• ë‚˜ìš”?</h4>
                    <div className="flex gap-3 justify-center">
                      {[
                        { emoji: 'ğŸ˜‹', label: 'ë§›ìˆì–´ìš”', value: 'good' },
                        { emoji: 'ğŸ˜', label: 'ë³´í†µì´ì—ìš”', value: 'normal' },
                        { emoji: 'ğŸ˜«', label: 'ë³„ë¡œì˜ˆìš”', value: 'bad' }
                      ].map(rating => (
                        <button
                          key={rating.value}
                          onClick={() => rateMeal(rating.value)}
                          className={`flex flex-col items-center gap-2 p-4 rounded-xl transition-all ${
                            currentRating === rating.value
                              ? 'bg-white shadow-lg scale-110'
                              : 'bg-white/50 hover:bg-white hover:shadow-md'
                          }`}
                        >
                          <span className="text-4xl">{rating.emoji}</span>
                          <span className="text-sm font-medium">{rating.label}</span>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>

                {/* ì˜ì–‘ ì •ë³´ & ê¸°íƒ€ */}
                <div className="space-y-6">
                  {/* ì¹¼ë¡œë¦¬ ê²Œì´ì§€ */}
                  {mealData.CAL_INFO && (
                    <div className="bg-white rounded-3xl shadow-xl p-6">
                      <h3 className="text-xl font-bold mb-4 gradient-text">ğŸ”¥ ì¹¼ë¡œë¦¬ ì •ë³´</h3>
                      <div className="text-center">
                        <div className="text-5xl font-bold text-orange-500 mb-2">
                          {mealData.CAL_INFO.replace(' Kcal', '')}
                        </div>
                        <div className="text-gray-600">Kcal</div>
                        <div className="mt-4 bg-gray-200 rounded-full h-4 overflow-hidden">
                          <div 
                            className="bg-gradient-to-r from-orange-400 to-red-500 h-full rounded-full transition-all"
                            style={{ width: `${Math.min((parseFloat(mealData.CAL_INFO) / 800) * 100, 100)}%` }}
                          />
                        </div>
                        <div className="text-sm text-gray-500 mt-2">
                          ê¶Œì¥ ì„­ì·¨ëŸ‰ ëŒ€ë¹„ {Math.round((parseFloat(mealData.CAL_INFO) / 800) * 100)}%
                        </div>
                      </div>
                    </div>
                  )}

                  {/* ì˜ì–‘ì†Œ ì •ë³´ */}
                  {mealData.NTR_INFO && (
                    <div className="bg-white rounded-3xl shadow-xl p-6">
                      <h3 className="text-xl font-bold mb-4 gradient-text">ğŸ“Š ì˜ì–‘ì†Œ</h3>
                      <div className="space-y-3">
                        {(() => {
                          const nutrients = parseNutrition(mealData.NTR_INFO);
                          if (!nutrients) return null;
                          
                          const colors = {
                            'íƒ„ìˆ˜í™”ë¬¼': 'from-blue-400 to-blue-500',
                            'ë‹¨ë°±ì§ˆ': 'from-red-400 to-red-500',
                            'ì§€ë°©': 'from-yellow-400 to-yellow-500',
                          };
                          
                          return Object.entries(nutrients).slice(0, 3).map(([name, value]) => (
                            <div key={name}>
                              <div className="flex justify-between mb-1">
                                <span className="font-medium">{name}</span>
                                <span className="font-bold">{value}g</span>
                              </div>
                              <div className="bg-gray-200 rounded-full h-3 overflow-hidden">
                                <div 
                                  className={`bg-gradient-to-r ${colors[name] || 'from-gray-400 to-gray-500'} h-full rounded-full transition-all`}
                                  style={{ width: `${Math.min((value / 100) * 100, 100)}%` }}
                                />
                              </div>
                            </div>
                          ));
                        })()}
                      </div>
                    </div>
                  )}

                  {/* ì›ì‚°ì§€ ì •ë³´ */}
                  {mealData.ORPLC_INFO && (
                    <div className="bg-white rounded-3xl shadow-xl p-6">
                      <h3 className="text-xl font-bold mb-4 gradient-text">ğŸŒ ì›ì‚°ì§€</h3>
                      <div className="text-sm text-gray-700 leading-relaxed">
                        {mealData.ORPLC_INFO.split('<br/>').map((info, idx) => (
                          <div key={idx} className="mb-2">{info}</div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* ì£¼ê°„ ë¯¸ë¦¬ë³´ê¸° */}
            {weeklyData.length > 0 && (
              <div className="bg-white rounded-3xl shadow-xl p-6 mb-6">
                <h3 className="text-2xl font-bold mb-6 gradient-text flex items-center gap-2">
                  <Calendar /> ì´ë²ˆ ì£¼ ê¸‰ì‹
                </h3>
                <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
                  {weeklyData.map((item, idx) => (
                    <div 
                      key={idx}
                      className={`p-4 rounded-xl cursor-pointer transition-all ${
                        item.data 
                          ? 'bg-gradient-to-br from-pink-50 to-purple-50 hover:shadow-lg' 
                          : 'bg-gray-100'
                      }`}
                      onClick={() => item.data && setSelectedDate(item.date)}
                    >
                      <div className="text-center mb-2">
                        <div className="font-bold text-gray-800">
                          {item.date.toLocaleDateString('ko-KR', { weekday: 'short' })}
                        </div>
                        <div className="text-sm text-gray-600">
                          {item.date.getMonth() + 1}/{item.date.getDate()}
                        </div>
                      </div>
                      {item.data ? (
                        <div className="space-y-1">
                          {item.data.DDISH_NM.split('<br/>').slice(0, 3).map((dish, i) => {
                            const emoji = getFoodEmoji(dish);
                            return (
                              <div key={i} className="text-xs truncate flex items-center gap-1">
                                <span>{emoji}</span>
                                <span>{dish.replace(/\([^)]*\)/g, '')}</span>
                              </div>
                            );
                          })}
                        </div>
                      ) : (
                        <div className="text-xs text-gray-400 text-center">ê¸‰ì‹ì—†ìŒ</div>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* í†µê³„ */}
            {Object.keys(statistics).length > 0 && (
              <div className="bg-white rounded-3xl shadow-xl p-6">
                <h3 className="text-2xl font-bold mb-6 gradient-text flex items-center gap-2">
                  <TrendingUp /> ìì£¼ ë‚˜ì˜¤ëŠ” ë©”ë‰´ TOP 5
                </h3>
                <div className="space-y-4">
                  {getTopDishes().map(([dish, count], idx) => {
                    const emoji = getFoodEmoji(dish);
                    const maxCount = getTopDishes()[0][1];
                    return (
                      <div key={idx} className="flex items-center gap-4">
                        <div className="text-3xl font-bold text-gray-300 w-8">#{idx + 1}</div>
                        <span className="text-2xl">{emoji}</span>
                        <div className="flex-1">
                          <div className="flex justify-between mb-1">
                            <span className="font-medium">{dish}</span>
                            <span className="font-bold text-purple-600">{count}ë²ˆ</span>
                          </div>
                          <div className="bg-gray-200 rounded-full h-3 overflow-hidden">
                            <div 
                              className="bg-gradient-to-r from-purple-400 to-pink-400 h-full rounded-full transition-all"
                              style={{ width: `${(count / maxCount) * 100}%` }}
                            />
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </>
        )}
      </div>
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SchoolLunchApp />);
    </script>
</body>
</html>
